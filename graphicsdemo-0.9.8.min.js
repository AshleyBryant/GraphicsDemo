(function(b){function a(a,f){this.element=a;this.options=b.extend({},e,f);this._defaults=e;this._name=c;var g=new Date;this.init();this.timeTaken=new Date-g}var c="graphicsdemo",e={version:"0.9.8",screen:0,graininess:1,blocky:!1,scale:1,wrapTexture:!1,colourMapFunction:null,steps:null,fps:24};a.prototype.init=function(){this.graphics=new GraphicsDemo.Graphics(this.element);null!=this.options.steps?(GraphicsDemo.StepsExecution.workingParams[GraphicsDemo.StepsExecution.processCount]={stepNo:0,graphics:this.graphics,
steps:this.options.steps,defaults:e,fps:this.options.fps},GraphicsDemo.StepsExecution.executeSteps(GraphicsDemo.StepsExecution.processCount++)):(this.graphics.createScreen(0),GraphicsDemo.Step.generateTexture(this.graphics,this.graphics.Screen[0],this.options),GraphicsDemo.Step.renderScreen(this.graphics,this.graphics.Screen[0],this.options))};b.fn[c]=function(d){var f=[];this.each(function(){var e=b.data(this,"plugin_"+c);e||(e=new a(this,d),b.data(this,"plugin_"+c,e));f.push(e)});return 1==f.length?
f[0]:f};a.prototype.regenerate=function(a){null!=a&&(this.options=b.extend({},e,a),this._defaults=e,this._name=c);a=new Date;this.graphics.clear();null!=this.options.steps?(GraphicsDemo.StepsExecution.workingParams[GraphicsDemo.StepsExecution.processCount]={stepNo:0,graphics:this.graphics,steps:this.options.steps,defaults:e,fps:this.options.fps},GraphicsDemo.StepsExecution.executeSteps(GraphicsDemo.StepsExecution.processCount++)):(this.graphics.createScreen(0),GraphicsDemo.Step.generateTexture(this.graphics,
this.graphics.Screen[0],this.options),GraphicsDemo.Step.renderScreen(this.graphics,this.graphics.Screen[0],this.options));this.timeTaken=new Date-a}})(jQuery,window,document);
var GraphicsDemo={StepsExecution:{processCount:0,workingParams:[],executeSteps:function(b){for(var a=this.workingParams[b],c=a.stepNo;c<a.steps.length;){var e=a.steps[c],d=$.extend({},a.defaults,e.params),f=a.graphics.Screen[d.screen];null==f&&(a.graphics.createScreen(d.screen),f=a.graphics.Screen[d.screen]);if(e.step==GraphicsDemo.Step.goTo){GraphicsDemo.StepsExecution.workingParams[b].stepNo=e.params.step;setTimeout("GraphicsDemo.StepsExecution.executeSteps("+b+")",Math.round(1E3/this.workingParams[b].fps));
break}else e.step(a.graphics,f,d),c++}}},Graphics:function(b){this.canvas=b;this.canvasContext=this.canvas.getContext("2d");this.Screen=[];this.createScreen=function(a){this.Screen[a]=new GraphicsDemo.Screen(this.canvasContext.createImageData(this.canvas.width,this.canvas.height))};this.renderScreen=function(a){this.canvasContext.putImageData(this.Screen[a].screenData,0,0)};this.clear=function(){this.canvasContext.clearRect(0,0,this.canvas.width,this.canvas.height);this.Screen=[]}},Screen:function(b){this.screenData=
b;this.data=b.data;this.width=b.width;this.height=b.height;this.setPixel=function(a,b,e){a=a+b*this.width<<2;this.data[a]=e.r;this.data[++a]=e.g;this.data[++a]=e.b;this.data[++a]=e.a};this.getPixel=function(a,b){var e=a+b*this.width<<2;return{r:this.data[e],g:this.data[++e],b:this.data[++e],a:this.data[++e]}};this.clear=function(){for(var a=0;a<this.height;a++)for(var b=0;b<this.width;b++)this.setPixel(b,a,{r:0,g:0,b:0,a:0})};this.applyColourMapping=function(a){for(var b=0;b<this.height;b++)for(var e=
0;e<this.width;e++)this.setPixel(e,b,a(this.getPixel(e,b)))}},Colour:{random:function(){return{r:256*Math.random()>>0,g:256*Math.random()>>0,b:256*Math.random()>>0,a:255}},averageWith:function(b,a){return{r:b.r+a.r>>1>>0,g:b.g+a.g>>1>>0,b:b.b+a.b>>1>>0,a:b.a+a.a>>1>>0}},deviateUpTo:function(b,a){var c={r:b.r+Math.floor(2*Math.random()*a+0.75)-a,g:b.g+Math.floor(2*Math.random()*a+0.75)-a,b:b.b+Math.floor(2*Math.random()*a+0.75)-a,a:b.a};0>c.r?c.r=0:255<c.r&&(c.r=255);0>c.g?c.g=0:255<c.g&&(c.g=255);
0>c.b?c.b=0:255<c.b&&(c.b=255);return c}},ColourMap:{colourTable:{},blackAndWhite:function(b){return{r:b.r,g:b.r,b:b.r,a:b.a}},red:function(b){return{r:b.r,g:0,b:0,a:b.a}},green:function(b){return{r:0,g:b.g,b:0,a:b.a}},blue:function(b){return{r:0,g:0,b:b.b,a:b.a}},clouds:function(b){return{r:b.r,g:b.r,b:255,a:b.a}},marble1:function(b){if(null==GraphicsDemo.ColourMap.colourTable.marble1){var a=[{r:240,g:255,b:240,a:255}];a[8]={r:216,g:233,b:209,a:255};a[100]={r:64,g:128,b:64,a:255};a[128]={r:8,g:16,
b:8,a:255};a[255]={r:8,g:16,b:8,a:255};GraphicsDemo.ColourMap.colourTable.marble1=GraphicsDemo.ColourMap.buildColourMap(a)}return GraphicsDemo.ColourMap.colourTable.marble1[128<b.r?255-b.r:b.r]},marble2:function(b){var a=128<b.r?255-b.r:b.r,c=100<a?(a-100)/28:0;return{r:254-(a>>1)-121*c,g:239-(a>>1)-82*c,b:218-(a>>1)-113*c,a:b.a}},marble3:function(b){if(null==GraphicsDemo.ColourMap.colourTable.marble3){var a=[{r:255,g:255,b:255,a:255}];a[64]={r:138,g:166,b:188,a:255};a[106]={r:81,g:124,b:163,a:255};
a[128]={r:12,g:57,b:96,a:255};a[255]={r:12,g:57,b:96,a:255};GraphicsDemo.ColourMap.colourTable.marble3=GraphicsDemo.ColourMap.buildColourMap(a)}return GraphicsDemo.ColourMap.colourTable.marble3[128<b.r?255-b.r:b.r]},marble4:function(b){if(null==GraphicsDemo.ColourMap.colourTable.marble4){var a=[{r:254,g:255,b:242,a:255}];a[100]={r:255,g:147,b:98,a:255};a[128]={r:192,g:35,b:0,a:255};a[255]={r:255,g:255,b:255,a:255};GraphicsDemo.ColourMap.colourTable.marble4=GraphicsDemo.ColourMap.buildColourMap(a)}return GraphicsDemo.ColourMap.colourTable.marble4[128<
b.r?255-b.r:b.r]},fire:function(b){if(null==GraphicsDemo.ColourMap.colourTable.fire){var a=[{r:0,g:0,b:0,a:255}];a[100]={r:255,g:0,b:0,a:255};a[172]={r:255,g:80,b:0,a:255};a[255]={r:255,g:255,b:0,a:255};GraphicsDemo.ColourMap.colourTable.fire=GraphicsDemo.ColourMap.buildColourMap(a)}return GraphicsDemo.ColourMap.colourTable.fire[b.r]},buildColourMap:function(b){if(null==b[0]||null==b[255])alert("Error, colours 0 and 255 must be defined!");else{for(var a=0,c=a+1;256>c;c++)null!=b[c]&&(this.interpolateColours(b,
a,c),a=c);return b}},interpolateColours:function(b,a,c){for(var e=c-a,d=b[a].r-b[c].r,f=b[a].g-b[c].g,g=b[a].b-b[c].b,j=a+1;j<c;j++){var h=(j-a)/e;b[j]={r:b[a].r-d*h>>0,g:b[a].g-f*h>>0,b:b[a].b-g*h>>0,a:255}}}},Step:{renderScreen:function(b,a,c){b.renderScreen(c.screen)},goTo:function(){},scrollBy:function(b,a,c){b=a.width<<2;var e=a.height<<2;if(0!=c.xAmount)for(var d=0,f=c.xAmount<<2,g=a.screenData.data,j=0;j<a.height;j++)for(var h=[],l=0,m=0;m<a.width;m++){var p=m-c.xAmount>=a.width?-b:0>m-c.xAmount?
b:0,k=l-f+p;h[l]=g[d];h[l+1]=g[d+1];h[l+2]=g[d+2];h[l+3]=g[d+3];null!=h[k]?(g[d]=h[k],g[d+1]=h[++k],g[d+2]=h[++k],g[d+3]=h[++k]):(k=d-f+p,g[d]=g[k],g[d+1]=g[++k],g[d+2]=g[++k],g[d+3]=g[++k]);l+=4;d+=4}if(0!=c.yAmount){f=c.yAmount<<2;g=a.screenData.data;for(m=0;m<a.width;m++){h=[];l=0;d=m<<2;for(j=0;j<a.width;j++)p=j-c.yAmount>=a.height?-(a.width*(a.height-1)<<2):0>j-c.yAmount?a.width*(a.height-1)<<2:0,k=l-f+(j-c.yAmount>=a.height?-e:0>j-c.yAmount?e:0),h[l]=g[d],h[l+1]=g[d+1],h[l+2]=g[d+2],h[l+3]=
g[d+3],null!=h[k]?(g[d]=h[k],g[d+1]=h[++k],g[d+2]=h[++k],g[d+3]=h[++k]):(k=d-c.yAmount*b+p,g[d]=g[k],g[d+1]=g[++k],g[d+2]=g[++k],g[d+3]=g[++k]),l+=4,d+=b}}},applyColourMap:function(b,a,c){a.applyColourMapping(c.colourMapFunction)},average:function(b,a){for(var c=a.screenData.data,e,d,f,g,j,h=0;h<a.height;h++)for(var l=0;l<a.width;l++)e=l+(0==h?a.height-1:h-1)*a.width<<2,d=(0==l?a.width-1:l-1)+h*a.width<<2,f=l+h*a.width<<2,g=(l==a.width-1?0:l+1)+h*a.width<<2,j=l+(h==a.height-1?0:h+1)*a.width<<2,e=
{r:(c[e]+c[d]+c[f]+c[g]+c[j])/5,g:(c[++e]+c[++d]+c[++f]+c[++g]+c[++j])/5,b:(c[++e]+c[++d]+c[++f]+c[++g]+c[++j])/5,a:255},a.setPixel(l,h,e)},combine:function(b,a,c){a=b.Screen[c.source1];var e=b.Screen[c.source2],d=b.Screen[c.dest];null==d&&(b.createScreen(c.destScreen),d=b.Screen[c.destScreen]);for(b=0;b<d.height;b++)for(c=0;c<d.width;c++){var f=a.getPixel(c,b),g=e.getPixel(c,b);d.setPixel(c,b,GraphicsDemo.Colour.averageWith(f,g))}},generateTexture:function(b,a,c){b=GraphicsDemo.Colour.random();var e=
c.wrapTexture?b:GraphicsDemo.Colour.random(),d=c.wrapTexture?b:GraphicsDemo.Colour.random(),f=c.wrapTexture?b:GraphicsDemo.Colour.random();a.setPixel(0,0,b);a.setPixel(a.width-1,0,e);a.setPixel(0,a.height-1,d);a.setPixel(a.width-1,a.height-1,f);GraphicsDemo.Step.recursivelyGenerateTexture(a,c,0,0,a.width-1,a.height-1,b,e,d,f);null!=c.colourMapFunction&&a.applyColourMapping(c.colourMapFunction)},recursivelyGenerateTexture:function(b,a,c,e,d,f,g,j,h,l){var m=d-c,p=f-e;if(!(1==m&&1==p)){var k=(m>>1)+
c,n=(p>>1)+e,v=(m+a.graininess)/a.scale,q=(p+a.graininess)/a.scale,r=b.getPixel(k,e);if(0==r.a||a.blocky)r=GraphicsDemo.Colour.deviateUpTo(GraphicsDemo.Colour.averageWith(g,j),v);1<m&&b.setPixel(k,e,r);var s=b.getPixel(c,n);if(0==s.a||a.blocky)s=GraphicsDemo.Colour.deviateUpTo(GraphicsDemo.Colour.averageWith(g,h),q);1<p&&b.setPixel(c,n,s);q=a.wrapTexture&&d==b.width-1?GraphicsDemo.Colour.deviateUpTo(b.getPixel(0,n),a.graininess/a.scale):GraphicsDemo.Colour.deviateUpTo(GraphicsDemo.Colour.averageWith(j,
l),q);1<p&&b.setPixel(d,n,q);var t=a.wrapTexture&&f==b.height-1?GraphicsDemo.Colour.deviateUpTo(b.getPixel(k,0),a.graininess/a.scale):GraphicsDemo.Colour.deviateUpTo(GraphicsDemo.Colour.averageWith(h,l),v);1<m&&b.setPixel(k,f,t);var u={r:r.r+t.r+s.r+q.r>>2>>0,g:r.g+t.g+s.g+q.g>>2>>0,b:r.b+t.b+s.b+q.b>>2>>0,a:r.a+t.a+s.a+q.a>>2>>0},u=GraphicsDemo.Colour.deviateUpTo(u,v);1<m&&1<p&&b.setPixel(k,n,u);(1<k-c||1<n-e)&&GraphicsDemo.Step.recursivelyGenerateTexture(b,a,c,e,k,n,g,r,s,u);(1<d-k||1<n-e)&&GraphicsDemo.Step.recursivelyGenerateTexture(b,
a,k,e,d,n,r,j,u,q);(1<k-c||1<f-n)&&GraphicsDemo.Step.recursivelyGenerateTexture(b,a,c,n,k,f,s,u,h,t);(1<d-k||1<f-n)&&GraphicsDemo.Step.recursivelyGenerateTexture(b,a,k,n,d,f,u,q,t,l)}}},Mask:{vertical:function(b,a,c){for(b=0;b<a.height;b++)for(var e=0;e<a.width;e++){var d=a.getPixel(e,b),f=b/(a.height-1);0!=c.pos&&(1==c.pos?f=1-f:2==c.pos&&(f=1-2*f,0>f&&(f=-f)));a.setPixel(e,b,{r:d.r>c.bgCol.r?d.r-(d.r-c.bgCol.r)*f:d.r+(c.bgCol.r-d.r)*f,g:d.g>c.bgCol.g?d.g-(d.g-c.bgCol.g)*f:d.g+(c.bgCol.g-d.g)*f,
b:d.b>c.bgCol.b?d.b-(d.b-c.bgCol.b)*f:d.b+(c.bgCol.b-d.b)*f,a:255})}},horizontal:function(b,a,c){for(b=0;b<a.height;b++)for(var e=0;e<a.width;e++){var d=a.getPixel(e,b),f=e/(a.width-1);0!=c.pos&&(1==c.pos?f=1-f:2==c.pos&&(f=1-2*f,0>f&&(f=-f)));a.setPixel(e,b,{r:d.r>c.bgCol.r?d.r-(d.r-c.bgCol.r)*f:d.r+(c.bgCol.r-d.r)*f,g:d.g>c.bgCol.g?d.g-(d.g-c.bgCol.g)*f:d.g+(c.bgCol.g-d.g)*f,b:d.b>c.bgCol.b?d.b-(d.b-c.bgCol.b)*f:d.b+(c.bgCol.b-d.b)*f,a:255})}},circular:function(b,a,c){b=a.width>>1;for(var e=a.height>>
1,d=b<e?b:e,f=0;f<a.height;f++)for(var g=0;g<a.width;g++){var j=a.getPixel(g,f),h=Math.sqrt((g-b)*(g-b)+(f-e)*(f-e));h<d?(h/=d,j={r:j.r+(c.bgCol.r-j.r)*h,g:j.g+(c.bgCol.g-j.g)*h,b:j.b+(c.bgCol.b-j.b)*h,a:255}):j={r:j.r+(c.bgCol.r-j.r),g:j.g+(c.bgCol.g-j.g),b:j.b+(c.bgCol.b-j.b),a:255};a.setPixel(g,f,j)}}}};